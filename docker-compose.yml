services:
  vanna-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: vanna-app
    ports:
      - "${VANNA_PORT:-8000}:${VANNA_PORT:-8000}"
    env_file:
      - .env
    volumes:
      - chroma_data:/app/chroma_db
      - ./.cursor:/app/.cursor
    networks:
      - vanna-network
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped
    depends_on:
      - ldap

  ldap:
    image: osixia/openldap:1.5.0
    container_name: ldap
    environment:
      LDAP_ORGANISATION: "${LDAP_ORGANISATION:-Vanna}"
      LDAP_DOMAIN: "${LDAP_DOMAIN:-vanna.ai}"
      LDAP_ADMIN_PASSWORD: "${LDAP_ADMIN_PASSWORD:-Vanna123}"
    ports:
      - "${LDAP_PORT:-389}:389"
      - "${LDAP_SSL_PORT:-636}:636"
    env_file:
      - .env
    volumes:
      - ldap_data:/var/lib/ldap
      - ldap_config:/etc/ldap/slapd.d
    networks:
      - vanna-network
    restart: unless-stopped

networks:
  vanna-network:
    driver: bridge

volumes:
  chroma_data:
  ldap_data:
  ldap_config:
